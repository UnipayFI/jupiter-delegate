/**
 * This code was AUTOGENERATED using the Codama library.
 * Please DO NOT EDIT THIS FILE, instead use visitors
 * to add features, then rerun Codama to update it.
 *
 * @see https://github.com/codama-idl/codama
 */

import {
  combineCodec,
  fixDecoderSize,
  fixEncoderSize,
  getAddressDecoder,
  getAddressEncoder,
  getBytesDecoder,
  getBytesEncoder,
  getProgramDerivedAddress,
  getStructDecoder,
  getStructEncoder,
  transformEncoder,
  type AccountMeta,
  type AccountSignerMeta,
  type Address,
  type Codec,
  type Decoder,
  type Encoder,
  type Instruction,
  type InstructionWithAccounts,
  type InstructionWithData,
  type ReadonlyAccount,
  type ReadonlyUint8Array,
  type TransactionSigner,
  type WritableAccount,
  type WritableSignerAccount,
} from "@solana/kit";
import { JUPITER_DELEGATE_PROGRAM_ADDRESS } from "../programs";
import {
  expectAddress,
  getAccountMetaFactory,
  type ResolvedAccount,
} from "../shared";
import {
  getStepParamsDecoder,
  getStepParamsEncoder,
  type StepParams,
  type StepParamsArgs,
} from "../types";

export const TWO_HOP_DISCRIMINATOR = new Uint8Array([
  82, 39, 54, 208, 18, 205, 214, 218,
]);

export function getTwoHopDiscriminatorBytes() {
  return fixEncoderSize(getBytesEncoder(), 8).encode(TWO_HOP_DISCRIMINATOR);
}

export type TwoHopInstruction<
  TProgram extends string = typeof JUPITER_DELEGATE_PROGRAM_ADDRESS,
  TAccountInputMintOne extends string | AccountMeta<string> = string,
  TAccountInputMintProgramOne extends string | AccountMeta<string> = string,
  TAccountOutputMintOne extends string | AccountMeta<string> = string,
  TAccountOutputMintProgramOne extends string | AccountMeta<string> = string,
  TAccountInputMintTwo extends string | AccountMeta<string> = string,
  TAccountInputMintProgramTwo extends string | AccountMeta<string> = string,
  TAccountOutputMintTwo extends string | AccountMeta<string> = string,
  TAccountOutputMintProgramTwo extends string | AccountMeta<string> = string,
  TAccountOperator extends string | AccountMeta<string> = string,
  TAccountVault extends string | AccountMeta<string> = string,
  TAccountDelegateInputTokenAccount extends
    | string
    | AccountMeta<string> = string,
  TAccountVaultInputTokenAccountOne extends
    | string
    | AccountMeta<string> = string,
  TAccountVaultOutputTokenAccountOne extends
    | string
    | AccountMeta<string> = string,
  TAccountVaultInputTokenAccountTwo extends
    | string
    | AccountMeta<string> = string,
  TAccountVaultOutputTokenAccountTwo extends
    | string
    | AccountMeta<string> = string,
  TAccountConfig extends string | AccountMeta<string> = string,
  TAccountAccess extends string | AccountMeta<string> = string,
  TAccountUser extends string | AccountMeta<string> = string,
  TAccountReceiverOutputTokenAccountOne extends
    | string
    | AccountMeta<string> = string,
  TAccountReceiverOutputTokenAccountTwo extends
    | string
    | AccountMeta<string> = string,
  TRemainingAccounts extends readonly AccountMeta<string>[] = []
> = Instruction<TProgram> &
  InstructionWithData<ReadonlyUint8Array> &
  InstructionWithAccounts<
    [
      TAccountInputMintOne extends string
        ? ReadonlyAccount<TAccountInputMintOne>
        : TAccountInputMintOne,
      TAccountInputMintProgramOne extends string
        ? ReadonlyAccount<TAccountInputMintProgramOne>
        : TAccountInputMintProgramOne,
      TAccountOutputMintOne extends string
        ? ReadonlyAccount<TAccountOutputMintOne>
        : TAccountOutputMintOne,
      TAccountOutputMintProgramOne extends string
        ? ReadonlyAccount<TAccountOutputMintProgramOne>
        : TAccountOutputMintProgramOne,
      TAccountInputMintTwo extends string
        ? ReadonlyAccount<TAccountInputMintTwo>
        : TAccountInputMintTwo,
      TAccountInputMintProgramTwo extends string
        ? ReadonlyAccount<TAccountInputMintProgramTwo>
        : TAccountInputMintProgramTwo,
      TAccountOutputMintTwo extends string
        ? ReadonlyAccount<TAccountOutputMintTwo>
        : TAccountOutputMintTwo,
      TAccountOutputMintProgramTwo extends string
        ? ReadonlyAccount<TAccountOutputMintProgramTwo>
        : TAccountOutputMintProgramTwo,
      TAccountOperator extends string
        ? WritableSignerAccount<TAccountOperator> &
            AccountSignerMeta<TAccountOperator>
        : TAccountOperator,
      TAccountVault extends string
        ? WritableAccount<TAccountVault>
        : TAccountVault,
      TAccountDelegateInputTokenAccount extends string
        ? WritableAccount<TAccountDelegateInputTokenAccount>
        : TAccountDelegateInputTokenAccount,
      TAccountVaultInputTokenAccountOne extends string
        ? WritableAccount<TAccountVaultInputTokenAccountOne>
        : TAccountVaultInputTokenAccountOne,
      TAccountVaultOutputTokenAccountOne extends string
        ? WritableAccount<TAccountVaultOutputTokenAccountOne>
        : TAccountVaultOutputTokenAccountOne,
      TAccountVaultInputTokenAccountTwo extends string
        ? WritableAccount<TAccountVaultInputTokenAccountTwo>
        : TAccountVaultInputTokenAccountTwo,
      TAccountVaultOutputTokenAccountTwo extends string
        ? WritableAccount<TAccountVaultOutputTokenAccountTwo>
        : TAccountVaultOutputTokenAccountTwo,
      TAccountConfig extends string
        ? WritableAccount<TAccountConfig>
        : TAccountConfig,
      TAccountAccess extends string
        ? ReadonlyAccount<TAccountAccess>
        : TAccountAccess,
      TAccountUser extends string
        ? ReadonlyAccount<TAccountUser>
        : TAccountUser,
      TAccountReceiverOutputTokenAccountOne extends string
        ? WritableAccount<TAccountReceiverOutputTokenAccountOne>
        : TAccountReceiverOutputTokenAccountOne,
      TAccountReceiverOutputTokenAccountTwo extends string
        ? WritableAccount<TAccountReceiverOutputTokenAccountTwo>
        : TAccountReceiverOutputTokenAccountTwo,
      ...TRemainingAccounts
    ]
  >;

export type TwoHopInstructionData = {
  discriminator: ReadonlyUint8Array;
  delegate: Address;
  step1: StepParams;
  step2: StepParams;
};

export type TwoHopInstructionDataArgs = {
  delegate: Address;
  step1: StepParamsArgs;
  step2: StepParamsArgs;
};

export function getTwoHopInstructionDataEncoder(): Encoder<TwoHopInstructionDataArgs> {
  return transformEncoder(
    getStructEncoder([
      ["discriminator", fixEncoderSize(getBytesEncoder(), 8)],
      ["delegate", getAddressEncoder()],
      ["step1", getStepParamsEncoder()],
      ["step2", getStepParamsEncoder()],
    ]),
    (value) => ({ ...value, discriminator: TWO_HOP_DISCRIMINATOR })
  );
}

export function getTwoHopInstructionDataDecoder(): Decoder<TwoHopInstructionData> {
  return getStructDecoder([
    ["discriminator", fixDecoderSize(getBytesDecoder(), 8)],
    ["delegate", getAddressDecoder()],
    ["step1", getStepParamsDecoder()],
    ["step2", getStepParamsDecoder()],
  ]);
}

export function getTwoHopInstructionDataCodec(): Codec<
  TwoHopInstructionDataArgs,
  TwoHopInstructionData
> {
  return combineCodec(
    getTwoHopInstructionDataEncoder(),
    getTwoHopInstructionDataDecoder()
  );
}

export type TwoHopAsyncInput<
  TAccountInputMintOne extends string = string,
  TAccountInputMintProgramOne extends string = string,
  TAccountOutputMintOne extends string = string,
  TAccountOutputMintProgramOne extends string = string,
  TAccountInputMintTwo extends string = string,
  TAccountInputMintProgramTwo extends string = string,
  TAccountOutputMintTwo extends string = string,
  TAccountOutputMintProgramTwo extends string = string,
  TAccountOperator extends string = string,
  TAccountVault extends string = string,
  TAccountDelegateInputTokenAccount extends string = string,
  TAccountVaultInputTokenAccountOne extends string = string,
  TAccountVaultOutputTokenAccountOne extends string = string,
  TAccountVaultInputTokenAccountTwo extends string = string,
  TAccountVaultOutputTokenAccountTwo extends string = string,
  TAccountConfig extends string = string,
  TAccountAccess extends string = string,
  TAccountUser extends string = string,
  TAccountReceiverOutputTokenAccountOne extends string = string,
  TAccountReceiverOutputTokenAccountTwo extends string = string
> = {
  inputMintOne: Address<TAccountInputMintOne>;
  inputMintProgramOne: Address<TAccountInputMintProgramOne>;
  outputMintOne: Address<TAccountOutputMintOne>;
  outputMintProgramOne: Address<TAccountOutputMintProgramOne>;
  inputMintTwo: Address<TAccountInputMintTwo>;
  inputMintProgramTwo: Address<TAccountInputMintProgramTwo>;
  outputMintTwo: Address<TAccountOutputMintTwo>;
  outputMintProgramTwo: Address<TAccountOutputMintProgramTwo>;
  operator: TransactionSigner<TAccountOperator>;
  vault?: Address<TAccountVault>;
  delegateInputTokenAccount: Address<TAccountDelegateInputTokenAccount>;
  vaultInputTokenAccountOne?: Address<TAccountVaultInputTokenAccountOne>;
  vaultOutputTokenAccountOne?: Address<TAccountVaultOutputTokenAccountOne>;
  vaultInputTokenAccountTwo?: Address<TAccountVaultInputTokenAccountTwo>;
  vaultOutputTokenAccountTwo?: Address<TAccountVaultOutputTokenAccountTwo>;
  config: Address<TAccountConfig>;
  access?: Address<TAccountAccess>;
  user: Address<TAccountUser>;
  receiverOutputTokenAccountOne?: Address<TAccountReceiverOutputTokenAccountOne>;
  receiverOutputTokenAccountTwo?: Address<TAccountReceiverOutputTokenAccountTwo>;
  delegate: TwoHopInstructionDataArgs["delegate"];
  step1: TwoHopInstructionDataArgs["step1"];
  step2: TwoHopInstructionDataArgs["step2"];
};

export async function getTwoHopInstructionAsync<
  TAccountInputMintOne extends string,
  TAccountInputMintProgramOne extends string,
  TAccountOutputMintOne extends string,
  TAccountOutputMintProgramOne extends string,
  TAccountInputMintTwo extends string,
  TAccountInputMintProgramTwo extends string,
  TAccountOutputMintTwo extends string,
  TAccountOutputMintProgramTwo extends string,
  TAccountOperator extends string,
  TAccountVault extends string,
  TAccountDelegateInputTokenAccount extends string,
  TAccountVaultInputTokenAccountOne extends string,
  TAccountVaultOutputTokenAccountOne extends string,
  TAccountVaultInputTokenAccountTwo extends string,
  TAccountVaultOutputTokenAccountTwo extends string,
  TAccountConfig extends string,
  TAccountAccess extends string,
  TAccountUser extends string,
  TAccountReceiverOutputTokenAccountOne extends string,
  TAccountReceiverOutputTokenAccountTwo extends string,
  TProgramAddress extends Address = typeof JUPITER_DELEGATE_PROGRAM_ADDRESS
>(
  input: TwoHopAsyncInput<
    TAccountInputMintOne,
    TAccountInputMintProgramOne,
    TAccountOutputMintOne,
    TAccountOutputMintProgramOne,
    TAccountInputMintTwo,
    TAccountInputMintProgramTwo,
    TAccountOutputMintTwo,
    TAccountOutputMintProgramTwo,
    TAccountOperator,
    TAccountVault,
    TAccountDelegateInputTokenAccount,
    TAccountVaultInputTokenAccountOne,
    TAccountVaultOutputTokenAccountOne,
    TAccountVaultInputTokenAccountTwo,
    TAccountVaultOutputTokenAccountTwo,
    TAccountConfig,
    TAccountAccess,
    TAccountUser,
    TAccountReceiverOutputTokenAccountOne,
    TAccountReceiverOutputTokenAccountTwo
  >,
  config?: { programAddress?: TProgramAddress }
): Promise<
  TwoHopInstruction<
    TProgramAddress,
    TAccountInputMintOne,
    TAccountInputMintProgramOne,
    TAccountOutputMintOne,
    TAccountOutputMintProgramOne,
    TAccountInputMintTwo,
    TAccountInputMintProgramTwo,
    TAccountOutputMintTwo,
    TAccountOutputMintProgramTwo,
    TAccountOperator,
    TAccountVault,
    TAccountDelegateInputTokenAccount,
    TAccountVaultInputTokenAccountOne,
    TAccountVaultOutputTokenAccountOne,
    TAccountVaultInputTokenAccountTwo,
    TAccountVaultOutputTokenAccountTwo,
    TAccountConfig,
    TAccountAccess,
    TAccountUser,
    TAccountReceiverOutputTokenAccountOne,
    TAccountReceiverOutputTokenAccountTwo
  >
> {
  // Program address.
  const programAddress =
    config?.programAddress ?? JUPITER_DELEGATE_PROGRAM_ADDRESS;

  // Original accounts.
  const originalAccounts = {
    inputMintOne: { value: input.inputMintOne ?? null, isWritable: false },
    inputMintProgramOne: {
      value: input.inputMintProgramOne ?? null,
      isWritable: false,
    },
    outputMintOne: { value: input.outputMintOne ?? null, isWritable: false },
    outputMintProgramOne: {
      value: input.outputMintProgramOne ?? null,
      isWritable: false,
    },
    inputMintTwo: { value: input.inputMintTwo ?? null, isWritable: false },
    inputMintProgramTwo: {
      value: input.inputMintProgramTwo ?? null,
      isWritable: false,
    },
    outputMintTwo: { value: input.outputMintTwo ?? null, isWritable: false },
    outputMintProgramTwo: {
      value: input.outputMintProgramTwo ?? null,
      isWritable: false,
    },
    operator: { value: input.operator ?? null, isWritable: true },
    vault: { value: input.vault ?? null, isWritable: true },
    delegateInputTokenAccount: {
      value: input.delegateInputTokenAccount ?? null,
      isWritable: true,
    },
    vaultInputTokenAccountOne: {
      value: input.vaultInputTokenAccountOne ?? null,
      isWritable: true,
    },
    vaultOutputTokenAccountOne: {
      value: input.vaultOutputTokenAccountOne ?? null,
      isWritable: true,
    },
    vaultInputTokenAccountTwo: {
      value: input.vaultInputTokenAccountTwo ?? null,
      isWritable: true,
    },
    vaultOutputTokenAccountTwo: {
      value: input.vaultOutputTokenAccountTwo ?? null,
      isWritable: true,
    },
    config: { value: input.config ?? null, isWritable: true },
    access: { value: input.access ?? null, isWritable: false },
    user: { value: input.user ?? null, isWritable: false },
    receiverOutputTokenAccountOne: {
      value: input.receiverOutputTokenAccountOne ?? null,
      isWritable: true,
    },
    receiverOutputTokenAccountTwo: {
      value: input.receiverOutputTokenAccountTwo ?? null,
      isWritable: true,
    },
  };
  const accounts = originalAccounts as Record<
    keyof typeof originalAccounts,
    ResolvedAccount
  >;

  // Original args.
  const args = { ...input };

  // Resolve default values.
  if (!accounts.vault.value) {
    accounts.vault.value = await getProgramDerivedAddress({
      programAddress,
      seeds: [
        getBytesEncoder().encode(
          new Uint8Array([
            106, 117, 112, 105, 116, 101, 114, 45, 100, 101, 108, 101, 103, 97,
            116, 101, 45, 118, 97, 117, 108, 116,
          ])
        ),
      ],
    });
  }
  if (!accounts.vaultInputTokenAccountOne.value) {
    accounts.vaultInputTokenAccountOne.value = await getProgramDerivedAddress({
      programAddress:
        "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
      seeds: [
        getAddressEncoder().encode(expectAddress(accounts.vault.value)),
        getAddressEncoder().encode(
          expectAddress(accounts.inputMintProgramOne.value)
        ),
        getAddressEncoder().encode(expectAddress(accounts.inputMintOne.value)),
      ],
    });
  }
  if (!accounts.vaultOutputTokenAccountOne.value) {
    accounts.vaultOutputTokenAccountOne.value = await getProgramDerivedAddress({
      programAddress:
        "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
      seeds: [
        getAddressEncoder().encode(expectAddress(accounts.vault.value)),
        getAddressEncoder().encode(
          expectAddress(accounts.outputMintProgramOne.value)
        ),
        getAddressEncoder().encode(expectAddress(accounts.outputMintOne.value)),
      ],
    });
  }
  if (!accounts.vaultInputTokenAccountTwo.value) {
    accounts.vaultInputTokenAccountTwo.value = await getProgramDerivedAddress({
      programAddress:
        "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
      seeds: [
        getAddressEncoder().encode(expectAddress(accounts.vault.value)),
        getAddressEncoder().encode(
          expectAddress(accounts.inputMintProgramTwo.value)
        ),
        getAddressEncoder().encode(expectAddress(accounts.inputMintTwo.value)),
      ],
    });
  }
  if (!accounts.vaultOutputTokenAccountTwo.value) {
    accounts.vaultOutputTokenAccountTwo.value = await getProgramDerivedAddress({
      programAddress:
        "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
      seeds: [
        getAddressEncoder().encode(expectAddress(accounts.vault.value)),
        getAddressEncoder().encode(
          expectAddress(accounts.outputMintProgramTwo.value)
        ),
        getAddressEncoder().encode(expectAddress(accounts.outputMintTwo.value)),
      ],
    });
  }
  if (!accounts.access.value) {
    accounts.access.value = await getProgramDerivedAddress({
      programAddress,
      seeds: [
        getBytesEncoder().encode(
          new Uint8Array([
            106, 117, 112, 105, 116, 101, 114, 45, 100, 101, 108, 101, 103, 97,
            116, 101, 45, 97, 99, 99, 101, 115, 115,
          ])
        ),
        getAddressEncoder().encode(expectAddress(accounts.user.value)),
      ],
    });
  }
  if (!accounts.receiverOutputTokenAccountOne.value) {
    accounts.receiverOutputTokenAccountOne.value =
      await getProgramDerivedAddress({
        programAddress:
          "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
        seeds: [
          getAddressEncoder().encode(expectAddress(accounts.user.value)),
          getAddressEncoder().encode(
            expectAddress(accounts.outputMintProgramOne.value)
          ),
          getAddressEncoder().encode(
            expectAddress(accounts.outputMintOne.value)
          ),
        ],
      });
  }
  if (!accounts.receiverOutputTokenAccountTwo.value) {
    accounts.receiverOutputTokenAccountTwo.value =
      await getProgramDerivedAddress({
        programAddress:
          "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL" as Address<"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL">,
        seeds: [
          getAddressEncoder().encode(expectAddress(accounts.user.value)),
          getAddressEncoder().encode(
            expectAddress(accounts.outputMintProgramTwo.value)
          ),
          getAddressEncoder().encode(
            expectAddress(accounts.outputMintTwo.value)
          ),
        ],
      });
  }

  const getAccountMeta = getAccountMetaFactory(programAddress, "programId");
  return Object.freeze({
    accounts: [
      getAccountMeta(accounts.inputMintOne),
      getAccountMeta(accounts.inputMintProgramOne),
      getAccountMeta(accounts.outputMintOne),
      getAccountMeta(accounts.outputMintProgramOne),
      getAccountMeta(accounts.inputMintTwo),
      getAccountMeta(accounts.inputMintProgramTwo),
      getAccountMeta(accounts.outputMintTwo),
      getAccountMeta(accounts.outputMintProgramTwo),
      getAccountMeta(accounts.operator),
      getAccountMeta(accounts.vault),
      getAccountMeta(accounts.delegateInputTokenAccount),
      getAccountMeta(accounts.vaultInputTokenAccountOne),
      getAccountMeta(accounts.vaultOutputTokenAccountOne),
      getAccountMeta(accounts.vaultInputTokenAccountTwo),
      getAccountMeta(accounts.vaultOutputTokenAccountTwo),
      getAccountMeta(accounts.config),
      getAccountMeta(accounts.access),
      getAccountMeta(accounts.user),
      getAccountMeta(accounts.receiverOutputTokenAccountOne),
      getAccountMeta(accounts.receiverOutputTokenAccountTwo),
    ],
    data: getTwoHopInstructionDataEncoder().encode(
      args as TwoHopInstructionDataArgs
    ),
    programAddress,
  } as TwoHopInstruction<TProgramAddress, TAccountInputMintOne, TAccountInputMintProgramOne, TAccountOutputMintOne, TAccountOutputMintProgramOne, TAccountInputMintTwo, TAccountInputMintProgramTwo, TAccountOutputMintTwo, TAccountOutputMintProgramTwo, TAccountOperator, TAccountVault, TAccountDelegateInputTokenAccount, TAccountVaultInputTokenAccountOne, TAccountVaultOutputTokenAccountOne, TAccountVaultInputTokenAccountTwo, TAccountVaultOutputTokenAccountTwo, TAccountConfig, TAccountAccess, TAccountUser, TAccountReceiverOutputTokenAccountOne, TAccountReceiverOutputTokenAccountTwo>);
}

export type TwoHopInput<
  TAccountInputMintOne extends string = string,
  TAccountInputMintProgramOne extends string = string,
  TAccountOutputMintOne extends string = string,
  TAccountOutputMintProgramOne extends string = string,
  TAccountInputMintTwo extends string = string,
  TAccountInputMintProgramTwo extends string = string,
  TAccountOutputMintTwo extends string = string,
  TAccountOutputMintProgramTwo extends string = string,
  TAccountOperator extends string = string,
  TAccountVault extends string = string,
  TAccountDelegateInputTokenAccount extends string = string,
  TAccountVaultInputTokenAccountOne extends string = string,
  TAccountVaultOutputTokenAccountOne extends string = string,
  TAccountVaultInputTokenAccountTwo extends string = string,
  TAccountVaultOutputTokenAccountTwo extends string = string,
  TAccountConfig extends string = string,
  TAccountAccess extends string = string,
  TAccountUser extends string = string,
  TAccountReceiverOutputTokenAccountOne extends string = string,
  TAccountReceiverOutputTokenAccountTwo extends string = string
> = {
  inputMintOne: Address<TAccountInputMintOne>;
  inputMintProgramOne: Address<TAccountInputMintProgramOne>;
  outputMintOne: Address<TAccountOutputMintOne>;
  outputMintProgramOne: Address<TAccountOutputMintProgramOne>;
  inputMintTwo: Address<TAccountInputMintTwo>;
  inputMintProgramTwo: Address<TAccountInputMintProgramTwo>;
  outputMintTwo: Address<TAccountOutputMintTwo>;
  outputMintProgramTwo: Address<TAccountOutputMintProgramTwo>;
  operator: TransactionSigner<TAccountOperator>;
  vault: Address<TAccountVault>;
  delegateInputTokenAccount: Address<TAccountDelegateInputTokenAccount>;
  vaultInputTokenAccountOne: Address<TAccountVaultInputTokenAccountOne>;
  vaultOutputTokenAccountOne: Address<TAccountVaultOutputTokenAccountOne>;
  vaultInputTokenAccountTwo: Address<TAccountVaultInputTokenAccountTwo>;
  vaultOutputTokenAccountTwo: Address<TAccountVaultOutputTokenAccountTwo>;
  config: Address<TAccountConfig>;
  access: Address<TAccountAccess>;
  user: Address<TAccountUser>;
  receiverOutputTokenAccountOne: Address<TAccountReceiverOutputTokenAccountOne>;
  receiverOutputTokenAccountTwo: Address<TAccountReceiverOutputTokenAccountTwo>;
  delegate: TwoHopInstructionDataArgs["delegate"];
  step1: TwoHopInstructionDataArgs["step1"];
  step2: TwoHopInstructionDataArgs["step2"];
};

export function getTwoHopInstruction<
  TAccountInputMintOne extends string,
  TAccountInputMintProgramOne extends string,
  TAccountOutputMintOne extends string,
  TAccountOutputMintProgramOne extends string,
  TAccountInputMintTwo extends string,
  TAccountInputMintProgramTwo extends string,
  TAccountOutputMintTwo extends string,
  TAccountOutputMintProgramTwo extends string,
  TAccountOperator extends string,
  TAccountVault extends string,
  TAccountDelegateInputTokenAccount extends string,
  TAccountVaultInputTokenAccountOne extends string,
  TAccountVaultOutputTokenAccountOne extends string,
  TAccountVaultInputTokenAccountTwo extends string,
  TAccountVaultOutputTokenAccountTwo extends string,
  TAccountConfig extends string,
  TAccountAccess extends string,
  TAccountUser extends string,
  TAccountReceiverOutputTokenAccountOne extends string,
  TAccountReceiverOutputTokenAccountTwo extends string,
  TProgramAddress extends Address = typeof JUPITER_DELEGATE_PROGRAM_ADDRESS
>(
  input: TwoHopInput<
    TAccountInputMintOne,
    TAccountInputMintProgramOne,
    TAccountOutputMintOne,
    TAccountOutputMintProgramOne,
    TAccountInputMintTwo,
    TAccountInputMintProgramTwo,
    TAccountOutputMintTwo,
    TAccountOutputMintProgramTwo,
    TAccountOperator,
    TAccountVault,
    TAccountDelegateInputTokenAccount,
    TAccountVaultInputTokenAccountOne,
    TAccountVaultOutputTokenAccountOne,
    TAccountVaultInputTokenAccountTwo,
    TAccountVaultOutputTokenAccountTwo,
    TAccountConfig,
    TAccountAccess,
    TAccountUser,
    TAccountReceiverOutputTokenAccountOne,
    TAccountReceiverOutputTokenAccountTwo
  >,
  config?: { programAddress?: TProgramAddress }
): TwoHopInstruction<
  TProgramAddress,
  TAccountInputMintOne,
  TAccountInputMintProgramOne,
  TAccountOutputMintOne,
  TAccountOutputMintProgramOne,
  TAccountInputMintTwo,
  TAccountInputMintProgramTwo,
  TAccountOutputMintTwo,
  TAccountOutputMintProgramTwo,
  TAccountOperator,
  TAccountVault,
  TAccountDelegateInputTokenAccount,
  TAccountVaultInputTokenAccountOne,
  TAccountVaultOutputTokenAccountOne,
  TAccountVaultInputTokenAccountTwo,
  TAccountVaultOutputTokenAccountTwo,
  TAccountConfig,
  TAccountAccess,
  TAccountUser,
  TAccountReceiverOutputTokenAccountOne,
  TAccountReceiverOutputTokenAccountTwo
> {
  // Program address.
  const programAddress =
    config?.programAddress ?? JUPITER_DELEGATE_PROGRAM_ADDRESS;

  // Original accounts.
  const originalAccounts = {
    inputMintOne: { value: input.inputMintOne ?? null, isWritable: false },
    inputMintProgramOne: {
      value: input.inputMintProgramOne ?? null,
      isWritable: false,
    },
    outputMintOne: { value: input.outputMintOne ?? null, isWritable: false },
    outputMintProgramOne: {
      value: input.outputMintProgramOne ?? null,
      isWritable: false,
    },
    inputMintTwo: { value: input.inputMintTwo ?? null, isWritable: false },
    inputMintProgramTwo: {
      value: input.inputMintProgramTwo ?? null,
      isWritable: false,
    },
    outputMintTwo: { value: input.outputMintTwo ?? null, isWritable: false },
    outputMintProgramTwo: {
      value: input.outputMintProgramTwo ?? null,
      isWritable: false,
    },
    operator: { value: input.operator ?? null, isWritable: true },
    vault: { value: input.vault ?? null, isWritable: true },
    delegateInputTokenAccount: {
      value: input.delegateInputTokenAccount ?? null,
      isWritable: true,
    },
    vaultInputTokenAccountOne: {
      value: input.vaultInputTokenAccountOne ?? null,
      isWritable: true,
    },
    vaultOutputTokenAccountOne: {
      value: input.vaultOutputTokenAccountOne ?? null,
      isWritable: true,
    },
    vaultInputTokenAccountTwo: {
      value: input.vaultInputTokenAccountTwo ?? null,
      isWritable: true,
    },
    vaultOutputTokenAccountTwo: {
      value: input.vaultOutputTokenAccountTwo ?? null,
      isWritable: true,
    },
    config: { value: input.config ?? null, isWritable: true },
    access: { value: input.access ?? null, isWritable: false },
    user: { value: input.user ?? null, isWritable: false },
    receiverOutputTokenAccountOne: {
      value: input.receiverOutputTokenAccountOne ?? null,
      isWritable: true,
    },
    receiverOutputTokenAccountTwo: {
      value: input.receiverOutputTokenAccountTwo ?? null,
      isWritable: true,
    },
  };
  const accounts = originalAccounts as Record<
    keyof typeof originalAccounts,
    ResolvedAccount
  >;

  // Original args.
  const args = { ...input };

  const getAccountMeta = getAccountMetaFactory(programAddress, "programId");
  return Object.freeze({
    accounts: [
      getAccountMeta(accounts.inputMintOne),
      getAccountMeta(accounts.inputMintProgramOne),
      getAccountMeta(accounts.outputMintOne),
      getAccountMeta(accounts.outputMintProgramOne),
      getAccountMeta(accounts.inputMintTwo),
      getAccountMeta(accounts.inputMintProgramTwo),
      getAccountMeta(accounts.outputMintTwo),
      getAccountMeta(accounts.outputMintProgramTwo),
      getAccountMeta(accounts.operator),
      getAccountMeta(accounts.vault),
      getAccountMeta(accounts.delegateInputTokenAccount),
      getAccountMeta(accounts.vaultInputTokenAccountOne),
      getAccountMeta(accounts.vaultOutputTokenAccountOne),
      getAccountMeta(accounts.vaultInputTokenAccountTwo),
      getAccountMeta(accounts.vaultOutputTokenAccountTwo),
      getAccountMeta(accounts.config),
      getAccountMeta(accounts.access),
      getAccountMeta(accounts.user),
      getAccountMeta(accounts.receiverOutputTokenAccountOne),
      getAccountMeta(accounts.receiverOutputTokenAccountTwo),
    ],
    data: getTwoHopInstructionDataEncoder().encode(
      args as TwoHopInstructionDataArgs
    ),
    programAddress,
  } as TwoHopInstruction<TProgramAddress, TAccountInputMintOne, TAccountInputMintProgramOne, TAccountOutputMintOne, TAccountOutputMintProgramOne, TAccountInputMintTwo, TAccountInputMintProgramTwo, TAccountOutputMintTwo, TAccountOutputMintProgramTwo, TAccountOperator, TAccountVault, TAccountDelegateInputTokenAccount, TAccountVaultInputTokenAccountOne, TAccountVaultOutputTokenAccountOne, TAccountVaultInputTokenAccountTwo, TAccountVaultOutputTokenAccountTwo, TAccountConfig, TAccountAccess, TAccountUser, TAccountReceiverOutputTokenAccountOne, TAccountReceiverOutputTokenAccountTwo>);
}

export type ParsedTwoHopInstruction<
  TProgram extends string = typeof JUPITER_DELEGATE_PROGRAM_ADDRESS,
  TAccountMetas extends readonly AccountMeta[] = readonly AccountMeta[]
> = {
  programAddress: Address<TProgram>;
  accounts: {
    inputMintOne: TAccountMetas[0];
    inputMintProgramOne: TAccountMetas[1];
    outputMintOne: TAccountMetas[2];
    outputMintProgramOne: TAccountMetas[3];
    inputMintTwo: TAccountMetas[4];
    inputMintProgramTwo: TAccountMetas[5];
    outputMintTwo: TAccountMetas[6];
    outputMintProgramTwo: TAccountMetas[7];
    operator: TAccountMetas[8];
    vault: TAccountMetas[9];
    delegateInputTokenAccount: TAccountMetas[10];
    vaultInputTokenAccountOne: TAccountMetas[11];
    vaultOutputTokenAccountOne: TAccountMetas[12];
    vaultInputTokenAccountTwo: TAccountMetas[13];
    vaultOutputTokenAccountTwo: TAccountMetas[14];
    config: TAccountMetas[15];
    access: TAccountMetas[16];
    user: TAccountMetas[17];
    receiverOutputTokenAccountOne: TAccountMetas[18];
    receiverOutputTokenAccountTwo: TAccountMetas[19];
  };
  data: TwoHopInstructionData;
};

export function parseTwoHopInstruction<
  TProgram extends string,
  TAccountMetas extends readonly AccountMeta[]
>(
  instruction: Instruction<TProgram> &
    InstructionWithAccounts<TAccountMetas> &
    InstructionWithData<ReadonlyUint8Array>
): ParsedTwoHopInstruction<TProgram, TAccountMetas> {
  if (instruction.accounts.length < 20) {
    // TODO: Coded error.
    throw new Error("Not enough accounts");
  }
  let accountIndex = 0;
  const getNextAccount = () => {
    const accountMeta = (instruction.accounts as TAccountMetas)[accountIndex]!;
    accountIndex += 1;
    return accountMeta;
  };
  return {
    programAddress: instruction.programAddress,
    accounts: {
      inputMintOne: getNextAccount(),
      inputMintProgramOne: getNextAccount(),
      outputMintOne: getNextAccount(),
      outputMintProgramOne: getNextAccount(),
      inputMintTwo: getNextAccount(),
      inputMintProgramTwo: getNextAccount(),
      outputMintTwo: getNextAccount(),
      outputMintProgramTwo: getNextAccount(),
      operator: getNextAccount(),
      vault: getNextAccount(),
      delegateInputTokenAccount: getNextAccount(),
      vaultInputTokenAccountOne: getNextAccount(),
      vaultOutputTokenAccountOne: getNextAccount(),
      vaultInputTokenAccountTwo: getNextAccount(),
      vaultOutputTokenAccountTwo: getNextAccount(),
      config: getNextAccount(),
      access: getNextAccount(),
      user: getNextAccount(),
      receiverOutputTokenAccountOne: getNextAccount(),
      receiverOutputTokenAccountTwo: getNextAccount(),
    },
    data: getTwoHopInstructionDataDecoder().decode(instruction.data),
  };
}
